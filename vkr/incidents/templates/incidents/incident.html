{% extends 'incidents/base.html' %}
{% load static %}

{% block links %}
<link rel="stylesheet" href="{% static 'incidents/css/style.css' %}">
{% endblock %}

{% block header %}
<header class="header fixed-top shadow-sm d-flex">
    <nav class="navbar navbar-expand-lg w-100">
        <a class="navbar-brand" href="#"></a>
        <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
        <ul class="navbar-nav ">
            <li class="nav-item px-5"><a class="nav-link" href="{% url 'incidents' %}">Инциденты</a></li>
            <li class="nav-item px-5"><a class="nav-link" href="{% url 'methods' %}">Методы</a></li>
            <li class="nav-item px-5"><a class="nav-link" href="{% url 'examples' %}">Примеры</a></li>
        </ul>
        </div>
        <ul class="navbar-nav position-fixed end-0 me-5 align-items-center">
            <li class="nav-item px-3 text-end mb-1">
                <div class="fullname">{{ request.user.get_full_name }}</div>
                <div class="username">({{ request.user.get_username }})</div>
            </li>
            <li class="nav-item px-3">
                <form action="{% url 'logout' %}" method="POST">
                    {% csrf_token %}
                    <button class="logout-btn" type="submit">Выйти</button>
                </form>
            </li>
          </ul>
    </nav>
</header>
{% endblock %}

{% block content %}
<div class="cards d-flex p-2 flex-column align-items-center">
    <div class="card mb-3">
        <div class="card-body m-2 mb-1">
          <h5 class="card-title">{{ incident.name }}</h5>
          <p class="card-text">{{ incident.description|linebreaks }}</p>
          <div class="row justify-content-between align-items-center pt-3 border-top">
            <p class="col card-subtitle text-success">· {{ incident.status }}</p>
            <p class="col card-subtitle text-muted"><i class="bi bi-person-gear"></i> {{ incident.creator.user.get_username }}</p>
            <p class="col card-subtitle text-muted text-end">{{ incident.created_at }}</p>
          </div>
        </div>
        <div class="card-body m-2 mb-1">
            <h5 class="card-title">Эксперты</h5>
            <ul class="list-group list-group-flush">
                {% for expert in incident.experts.all %}
                <li class="list-group-item">{{ forloop.counter }}. {{ expert.user.get_full_name }} ({{ expert.user.get_username }})</li>
                {% endfor %}
            </ul>
        </div>
        <div class="card-body m-2 mb-1">
            <h5 class="card-title">Критерии</h5>
            <ul class="list-group list-group-flush">
                {% for criteria in incident.criteries.all %}
                <li class="list-group-item">{{ forloop.counter }}. {{ criteria }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="card-body m-2 mb-1">
            <h5 class="card-title">Базисы</h5>
            <div class="list-group">
                {% for basis in incident.basises.all %}
                <a class="list-group-item flex-column align-items-start">
                  <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">{{ forloop.counter }}. {{ basis.name }}</h5>
                  </div>
                  <p class="mb-1">{{ basis.description|linebreaks }}</p>
                </a>
                {% endfor %}
            </div>
        </div>
        <div class="card-body m-2 mb-1">
            <h5 class="card-title">Стратегии</h5>
            <div class="list-group">
                {% for strategy in incident.strategies.all %}
                <a class="list-group-item flex-column align-items-start">
                  <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">{{ forloop.counter }}. {{ strategy.name }}</h5>
                  </div>
                  <p class="mb-1">{{ strategy.description|linebreaks }}</p>
                </a>
                {% endfor %}
            </div>
        </div>
        <div class="card-body m-2 mb-1">
          <h5 class="card-title">Оценки экспертов</h5>
          {% if not experts_with_scores %}
          <p class="card-text">Ни один эксперт не предоставил своих оценок по инциденту.</p>
          {% else %}
          <div class="list-group">
            {% for expert in experts_with_scores %}
            <a class="list-group-item flex-column align-items-start">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">{{ expert.expert.user.get_full_name }} ({{ expert.expert.user.get_username }}):</h5>
              </div>
              <p class="mb-1">{{ expert.scores }}</p>
            </a>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        <div class="card-body m-2 mb-1">
          <h5 class="card-title">Результаты</h5>
          {% if not incident.results %}
          <p class="card-text">Ранжирование стратегий по инциденту еще не расчитано.</p>
          {% else %}
          <p class="card-text">{{ incident.results }}</p>
          {% endif %}
        </div>
      </div>
</div>
{% endblock %}